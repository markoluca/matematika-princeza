<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–∫–∞ –ü—Ä–∏–Ω—Ü–µ–∑–∞</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ff69b4">

<style>
body{
font-family:'Arial Rounded MT Bold', Arial, sans-serif;
margin:0;
padding:20px;
text-align:center;
transition:0.4s;
}

.rose{background:linear-gradient(#ffe6f2,#fff4cc);}
.purple{background:linear-gradient(#f3e6ff,#e6ccff);}
.mint{background:linear-gradient(#e6fff7,#ccfff2);}

h1{color:#d63384;}

.container{max-width:520px;margin:auto;}

.card{
background:white;
border-radius:30px;
padding:25px;
box-shadow:0 15px 30px rgba(0,0,0,0.15);
}

.category-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:10px;
margin-bottom:15px;
}

.cat-btn{
padding:12px;
border:none;
border-radius:15px;
font-size:14px;
font-weight:bold;
cursor:pointer;
color:white;
transition:0.2s;
}

.cat-btn:hover{transform:scale(1.05);}

.add{background:#ff6b9d;}
.sub{background:#845ec2;}
.first{background:#ffc75f;}
.second{background:#00c9a7;}
.prev{background:#ff9671;}
.compare{background:#4d8076;}

.question{
font-size:32px;
margin:20px 0;
}

input{
font-size:26px;
padding:8px;
width:100px;
border-radius:15px;
border:3px solid #ccc;
text-align:center;
}

.correct{border-color:#28a745;}
.wrong{border-color:#dc3545;}

.feedback{height:24px;font-weight:bold;}

.progress{
height:12px;
background:#eee;
border-radius:20px;
margin-top:10px;
overflow:hidden;
}

.progress-bar{
height:12px;
background:#ff69b4;
width:0%;
transition:0.4s;
}

.badges{margin-top:10px;font-size:20px;}
.map{margin-top:10px;font-size:18px;}

.theme-select{margin-bottom:10px;}
</style>
</head>

<body class="rose">

<h1>üëë –ú–∞—Ç–µ–º–∞—Ç–∏—á–∫–∞ –ü—Ä–∏–Ω—Ü–µ–∑–∞</h1>

<div class="container">
<div class="card">

<input type="text" id="ime" placeholder="–£–Ω–µ—Å–∏ –∏–º–µ">
<button onclick="sacuvajIme()">–°–∞—á—É–≤–∞—ò</button>

<h3 id="pozdrav"></h3>

<div class="theme-select">
–¢–µ–º–∞:
<select onchange="promeniTemu(this.value)">
<option value="rose">–†–æ–∑–µ</option>
<option value="purple">–â—É–±–∏—á–∞—Å—Ç–∞</option>
<option value="mint">–ú–∏–Ω—Ç</option>
</select>
</div>

<div class="category-grid">
<button class="cat-btn add" onclick="setCategory('add')">–°–∞–±–∏—Ä–∞—ö–µ</button>
<button class="cat-btn sub" onclick="setCategory('sub')">–û–¥—É–∑–∏–º–∞—ö–µ</button>
<button class="cat-btn first" onclick="setCategory('first10')">–ü—Ä–≤–∞ –¥–µ—Å–µ—Ç–∏—Ü–∞</button>
<button class="cat-btn second" onclick="setCategory('second10')">–î—Ä—É–≥–∞ –¥–µ—Å–µ—Ç–∏—Ü–∞</button>
<button class="cat-btn prev" onclick="setCategory('prevnext')">–ü—Ä–µ—Ç—Ö–æ–¥–Ω–∏–∫/–°–ª–µ–¥–±.</button>
<button class="cat-btn compare" onclick="setCategory('compare')">–£–ø–æ—Ä–µ–¥–∏</button>
</div>

<div class="question" id="question"></div>
<input type="text" id="answer" oninput="checkAnswer()">

<div class="feedback" id="feedback"></div>

<p>–ó–≤–µ–∑–¥–∏—Ü–µ: <span id="stars">0</span> ‚≠ê | –ù–∏–≤–æ: <span id="level">1</span></p>

<div class="progress"><div class="progress-bar" id="progressBar"></div></div>

<div class="badges" id="badges"></div>
<div class="map" id="map"></div>

</div>
</div>

<script>
let category="add";
let correct;
let stars=parseInt(localStorage.getItem("stars")||0);
let level=parseInt(localStorage.getItem("level")||1);
let correctStreak=0;
let wrongStreak=0;
let difficulty=1;

ucitaj();

function rand(min,max){return Math.floor(Math.random()*(max-min+1))+min;}

function sacuvajIme(){
let ime=document.getElementById("ime").value;
localStorage.setItem("ime",ime);
document.getElementById("pozdrav").innerText="–î–æ–±—Ä–æ –¥–æ—à–ª–∞, "+ime+" üëë";
}

function ucitaj(){
let ime=localStorage.getItem("ime");
if(ime) document.getElementById("pozdrav").innerText="–î–æ–±—Ä–æ –¥–æ—à–ª–∞, "+ime+" üëë";
updateUI();
}

function promeniTemu(t){
document.body.className=t;
}

function setCategory(cat){category=cat;newTask();}

function updateUI(){
document.getElementById("stars").innerText=stars;
document.getElementById("level").innerText=level;
document.getElementById("progressBar").style.width=(stars%10)*10+"%";
updateBadges();
updateMap();
}

function updateBadges(){
let html="";
for(let i=0;i<Math.floor(stars/10);i++) html+="üëë ";
document.getElementById("badges").innerHTML=html;
}

function updateMap(){
let html="–ù–∞–ø—Ä–µ–¥–∞–∫: ";
for(let i=1;i<=10;i++) html+= i<=level?"‚≠ê ":"‚òÜ ";
document.getElementById("map").innerHTML=html;
}

function adjustDifficulty(){
if(correctStreak>=3 && difficulty<3){difficulty++;correctStreak=0;}
if(wrongStreak>=2 && difficulty>1){difficulty--;wrongStreak=0;}
}

function newTask(){
let max=difficulty===1?10:20;
let q="";

if(category==="add"){
let a=rand(0,max),b=rand(0,max);
if(a+b>20) return newTask();
correct=a+b;
q=`${a} + ${b} = ?`;
}

if(category==="sub"){
let a=rand(0,max),b=rand(0,max);
if(b>a)[a,b]=[b,a];
correct=a-b;
q=`${a} - ${b} = ?`;
}

if(category==="first10"){
let s=difficulty===1?rand(0,5):rand(0,7);
correct=s+2;
q=`${s}, ${s+1}, __ , ${s+3}`;
}

if(category==="second10"){
let s=difficulty===1?rand(10,15):rand(10,17);
correct=s+2;
q=`${s}, ${s+1}, __ , ${s+3}`;
}

if(category==="prevnext"){
let n=difficulty===1?rand(2,10):rand(5,18);
correct=n-1;
q=`__, ${n}, ${n+1}`;
}

if(category==="compare"){
let a=rand(0,max),b=rand(0,max);
correct=a>b?">":a<b?"<":"=";
q=`${a} ? ${b}`;
}

document.getElementById("question").innerText=q;
document.getElementById("answer").value="";
document.getElementById("feedback").innerText="";
document.getElementById("answer").className="";
}

function checkAnswer(){
let user=document.getElementById("answer").value;

if(user==correct){
stars++;
correctStreak++;
wrongStreak=0;

if(stars%30===0){
level++;
alert("–ë—Ä–∞–≤–æ! –ù–æ–≤–∏ –Ω–∏–≤–æ üéâ");
}

localStorage.setItem("stars",stars);
localStorage.setItem("level",level);

adjustDifficulty();
updateUI();

document.getElementById("answer").className="correct";
document.getElementById("feedback").innerText="–ë—Ä–∞–≤–æ! üå∏";

setTimeout(newTask,800);
}else{
wrongStreak++;
correctStreak=0;
adjustDifficulty();
document.getElementById("answer").className="wrong";
document.getElementById("feedback").innerText="–ü–æ–∫—É—à–∞—ò –ø–æ–Ω–æ–≤–æ";
}
}

newTask();

if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
