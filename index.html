<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üëë –õ—É—á–∏—Ü–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ </title>

<style>
body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,sans-serif;
 background:linear-gradient(#fbcfe8,#fdf2f8);
 text-align:center;
}

header{
 background:#c026d3;
 color:white;
 padding:20px;
 font-size:22px;
}

.avatar{font-size:60px;margin-top:10px;}

.container{padding:20px;max-width:800px;margin:auto;}

.card{
 background:white;
 padding:20px;
 border-radius:25px;
 box-shadow:0 10px 25px rgba(0,0,0,0.1);
 margin-bottom:20px;
}

input{
 padding:10px;
 font-size:18px;
 width:60px;
 border-radius:10px;
 border:2px solid #f9a8d4;
 text-align:center;
 margin:5px;
}

button{
 padding:14px;
 font-size:16px;
 border-radius:20px;
 border:none;
 background:#d946ef;
 color:white;
 margin:5px;
}

.krune{font-size:18px;margin:10px;}

.sparkle{
 position:absolute;
 font-size:30px;
 animation:float 1s ease-out forwards;
}

@keyframes float{
 from{transform:translateY(0);opacity:1;}
 to{transform:translateY(-80px);opacity:0;}
}

table{
 width:100%;
 border-collapse:collapse;
}

td,th{
 border:1px solid #ddd;
 padding:8px;
}
</style>
</head>

<body>

<header>üëë Princess Math Premium üëë</header>
<div class="avatar">üë∏üè∞‚ú®</div>

<div class="container">

<div class="card">
 <input id="ime" placeholder="–ò–º–µ –ø—Ä–∏–Ω—Ü–µ–∑–µ">
 <button onclick="startGame()">–ó–∞–ø–æ—á–Ω–∏ Premium –∏–∑–∞–∑–æ–≤</button>
</div>

<div class="krune" id="info"></div>

<div class="card">
 <div id="zadatak">–î–æ–±—Ä–æ–¥–æ—à–ª–∞ —É Premium –∞–≤–∞–Ω—Ç—É—Ä—É!</div>
 <div id="odgovorPolje"></div>
 <div id="poruka"></div>
</div>

<div class="card" id="rezultatCard" style="display:none;"></div>

<div class="card">
 <h3>üèÜ –ù–∞—ò–±–æ—ô–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h3>
 <table>
  <thead>
   <tr><th>–ò–º–µ</th><th>–ö—Ä—É–Ω–µ</th></tr>
  </thead>
  <tbody id="scoreTable"></tbody>
 </table>
</div>

</div>

<script>
let ime="";
let level=1;
let question=0;
let krune=0;
let correct=0;
let limit=10;
let tacni=[];
let bestScores=JSON.parse(localStorage.getItem("princessScores"))||[];

function rand(max){return Math.floor(Math.random()*max)+1;}

function startGame(){
 ime=document.getElementById("ime").value||"–ü—Ä–∏–Ω—Ü–µ–∑–∞";
 level=1;
 krune=0;
 correct=0;
 question=0;
 updateInfo();
 document.getElementById("rezultatCard").style.display="none";
 nextQuestion();
}

function updateInfo(){
 document.getElementById("info").innerHTML=
 "–ù–∏–≤–æ: "+level+" | –ü–∏—Ç–∞—ö–µ: "+(question+1)+"/10 | –ö—Ä—É–Ω–µ: "+krune+" üëë";
}

function nextQuestion(){
 if(question>=limit){
  levelUp();
  return;
 }

 document.getElementById("poruka").innerHTML="";
 document.getElementById("odgovorPolje").innerHTML="";
 tacni=[];

 let type=Math.floor(Math.random()*3);
 let tekst=(question+1)+". ";

 if(type===0){
  tekst+="–ù–∞–ø–∏—à–∏ —Å–≤–µ –ø–∞—Ä–Ω–µ –±—Ä–æ—ò–µ–≤–µ –ø—Ä–≤–µ –¥–µ—Å–µ—Ç–∏—Ü–µ.";
  tacni=[2,4,6,8];
  for(let i=0;i<4;i++){
   document.getElementById("odgovorPolje").innerHTML+=
   `<input id="b${i}"> , `;
  }
  document.getElementById("odgovorPolje").innerHTML+="10";
 }

 if(type===1){
  let a=rand(10+level*2);
  let b=rand(20-a);
  tacni=[a,b,a+b];
  tekst+="–ü—Ä–∏–Ω—Ü–µ–∑–∞ –∏–º–∞ "+a+" –∫—Ä—É–Ω–∞. –î–æ–±–∏–ª–∞ —ò–µ "+b+
  ". –ü–æ–ø—É–Ω–∏:";
  document.getElementById("odgovorPolje").innerHTML=
  `<input id="b0"> + <input id="b1"> = <input id="b2">`;
 }

 if(type===2){
  let a=rand(12+level*2);
  let b=rand(a-1);
  tacni=[a,b,a-b];
  tekst+="–ü—Ä–∏–Ω—Ü–µ–∑–∞ —ò–µ –∏–º–∞–ª–∞ "+a+" —Ü–≤–µ—Ç–æ–≤–∞. –ü–æ–∫–ª–æ–Ω–∏–ª–∞ "+b+
  ". –ü–æ–ø—É–Ω–∏:";
  document.getElementById("odgovorPolje").innerHTML=
  `<input id="b0"> - <input id="b1"> = <input id="b2">`;
 }

 document.getElementById("zadatak").innerHTML=tekst;

 setTimeout(()=>{
  document.querySelectorAll("#odgovorPolje input")
  .forEach(el=>el.addEventListener("change",proveri));
 },100);

 updateInfo();
}

function proveri(){
 let inputs=document.querySelectorAll("#odgovorPolje input");
 let unosi=[];
 for(let i=0;i<inputs.length;i++){
  if(inputs[i].value==="") return;
  unosi.push(parseInt(inputs[i].value));
 }

 let tacno=true;
 for(let i=0;i<tacni.length;i++){
  if(unosi[i]!==tacni[i]) tacno=false;
 }

 if(tacno){
  krune++; correct++;
  sparkle();
  document.getElementById("poruka").innerHTML="–ë—Ä–∞–≤–æ! üëë";
 }else{
  document.getElementById("poruka").innerHTML=
  "–ù–µ—Ç–∞—á–Ω–æ ‚ùå<br>–¢–∞—á–Ω–æ: "+tacni.join(" ");
 }

 question++;
 setTimeout(nextQuestion,1500);
}

function levelUp(){
 if(level<3){
  level++;
  question=0;
  document.getElementById("poruka").innerHTML=
  "üéâ –ü—Ä–µ–ª–∞–∑–∏—à –Ω–∞ –Ω–∏–≤–æ "+level+"!";
  setTimeout(nextQuestion,2000);
 }else{
  finish();
 }
}

function finish(){
 document.getElementById("rezultatCard").style.display="block";

 let titula="–ú–∞–ª–∞ –ø—Ä–∏–Ω—Ü–µ–∑–∞ üëë";
 if(krune>=20) titula="–í–µ–ª–∏–∫–∞ –ø—Ä–∏–Ω—Ü–µ–∑–∞ üëë‚ú®";
 if(krune>=28) titula="–ö–†–ê–â–ò–¶–ê –ú–ê–¢–ï–ú–ê–¢–ò–ö–ï üëëüèÜ";

 if(titula.includes("–ö–†–ê–â–ò–¶–ê")){
  for(let i=0;i<10;i++) sparkle();
 }

 bestScores.push({ime:ime,krune:krune});
 bestScores.sort((a,b)=>b.krune-a.krune);
 bestScores=bestScores.slice(0,5);
 localStorage.setItem("princessScores",JSON.stringify(bestScores));
 updateTable();

 document.getElementById("rezultatCard").innerHTML=
 "<h3>üëë –ö–†–ê–à PREMIUM –ò–ó–ê–ó–û–í–ê üëë</h3>"+
 "–û—Å–≤–æ—ò–µ–Ω–µ –∫—Ä—É–Ω–µ: "+krune+
 "<br>"+titula+
 "<br><br><button onclick='printDiploma()'>üéì –î–∏–ø–ª–æ–º–∞</button>";
}

function updateTable(){
 let tbody=document.getElementById("scoreTable");
 tbody.innerHTML="";
 bestScores.forEach(s=>{
  tbody.innerHTML+=`<tr><td>${s.ime}</td><td>${s.krune}</td></tr>`;
 });
}

function printDiploma(){
 let w=window.open("");
 w.document.write(`
 <h1>üéì –î–ò–ü–õ–û–ú–ê üéì</h1>
 <h2>${ime}</h2>
 <p>–û—Å–≤–æ—ò–µ–Ω–µ –∫—Ä—É–Ω–µ: ${krune}</p>
 <h2>–ö–†–ê–â–ï–í–°–ö–ò –£–°–ü–ï–• üëë</h2>
 `);
 w.print();
}

function sparkle(){
 let s=document.createElement("div");
 s.className="sparkle";
 s.innerHTML="üëë";
 s.style.left=Math.random()*90+"%";
 s.style.top="50%";
 document.body.appendChild(s);
 setTimeout(()=>s.remove(),1000);
}

updateTable();
</script>

</body>
</html>
