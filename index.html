<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üëë Princess Math Premium PEDAGO≈†KA AI</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,sans-serif;
 background:linear-gradient(#fbcfe8,#fdf2f8);
 text-align:center;
}

header{
 background:#7e22ce;
 color:white;
 padding:20px;
 font-size:22px;
}

.container{padding:20px;max-width:900px;margin:auto;}

.card{
 background:white;
 padding:25px;
 border-radius:25px;
 box-shadow:0 10px 25px rgba(0,0,0,0.1);
 margin-bottom:20px;
}

input{
 padding:12px;
 font-size:20px;
 font-weight:bold;
 width:70px;
 border-radius:12px;
 border:2px solid #f472b6;
 text-align:center;
 margin:5px;
}

button{
 padding:14px;
 font-size:16px;
 border-radius:20px;
 border:none;
 background:#d946ef;
 color:white;
 margin:5px;
}

.bold{font-weight:bold;}
</style>
</head>

<body>

<header>üëë Princess Math Premium ‚Äì Pedago≈°ka AI üëë</header>

<div class="container">

<div class="card">
 <input id="ime" placeholder="–ò–º–µ –ø—Ä–∏–Ω—Ü–µ–∑–µ">
 <button onclick="startGame()">–ó–∞–ø–æ—á–Ω–∏ –∏–≥—Ä—É</button>
</div>

<div class="card">
 <div id="info" class="bold"></div>
 <div id="zadatak" class="bold"></div>
 <div id="odgovorPolje"></div>
 <div id="poruka" class="bold"></div>
</div>

<div class="card" id="rezultatCard" style="display:none;"></div>

<div class="card">
 <h3>üìä –ì—Ä–∞—Ñ–∏–∫–æ–Ω –Ω–∞–ø—Ä–µ–¥–∫–∞</h3>
 <canvas id="progressChart"></canvas>
</div>

<div class="card">
 <h3>üéì –ü–µ–¥–∞–≥–æ—à–∫–∏ –∏–∑–≤–µ—à—Ç–∞—ò</h3>
 <div id="report"></div>
</div>

</div>

<script>
let ime="";
let question=0;
let limit=10;
let krune=0;
let mistakes=0;
let sabErrors=0;
let oduzErrors=0;
let difficulty=3;
let streak=0;
let tacni=[];

let history=JSON.parse(localStorage.getItem("princessHistory"))||[];

function rand(min,max){
 return Math.floor(Math.random()*(max-min+1))+min;
}

function today(){
 return new Date().toISOString().split("T")[0];
}

function startGame(){
 ime=document.getElementById("ime").value||"–ü—Ä–∏–Ω—Ü–µ–∑–∞";
 question=0;
 krune=0;
 mistakes=0;
 sabErrors=0;
 oduzErrors=0;
 difficulty=3;
 streak=0;
 document.getElementById("rezultatCard").style.display="none";
 nextQuestion();
}

function updateInfo(){
 document.getElementById("info").innerHTML=
 "–ü–∏—Ç–∞—ö–µ: "+(question+1)+"/"+limit+
 " | –ö—Ä—É–Ω–µ: "+krune+
 " | –¢–µ–∂–∏–Ω–∞: "+difficulty;
}

function nextQuestion(){
 if(question>=limit){
  finish();
  return;
 }

 document.getElementById("poruka").innerHTML="";
 document.getElementById("odgovorPolje").innerHTML="";
 tacni=[];

 let type=Math.random()<0.5?0:1;
 let a=rand(5*difficulty,20);
 let b=rand(1,10);

 if(type===0){
  if(a+b>20) b=20-a;
  tacni=[a,"+",b,a+b];
  document.getElementById("zadatak").innerHTML=
  (question+1)+". –ü—Ä–∏–Ω—Ü–µ–∑–∞ –∏–º–∞ <b>"+a+
  "</b> –∫—Ä—É–Ω–∞ –∏ –¥–æ–±–∏–ª–∞ —ò–µ <b>"+b+
  "</b>. –ü–æ–ø—É–Ω–∏:";
 }else{
  if(b>=a) b=a-1;
  tacni=[a,"-",b,a-b];
  document.getElementById("zadatak").innerHTML=
  (question+1)+". –ü—Ä–∏–Ω—Ü–µ–∑–∞ —ò–µ –∏–º–∞–ª–∞ <b>"+a+
  "</b> —Ü–≤–µ—Ç–æ–≤–∞ –∏ –ø–æ–∫–ª–æ–Ω–∏–ª–∞ <b>"+b+
  "</b>. –ü–æ–ø—É–Ω–∏:";
 }

 document.getElementById("odgovorPolje").innerHTML=
 `<input id="b0"> <input id="b1"> <input id="b2"> = <input id="b3">`;

 setTimeout(()=>{
  document.querySelectorAll("#odgovorPolje input")
  .forEach(el=>el.addEventListener("change",proveri));
 },100);

 updateInfo();
}

function proveri(){
 let inputs=document.querySelectorAll("#odgovorPolje input");
 let unosi=[];
 for(let i=0;i<inputs.length;i++){
  if(inputs[i].value==="") return;
  unosi.push(inputs[i].value);
 }

 let tacno=true;
 for(let i=0;i<tacni.length;i++){
  if(unosi[i]!=tacni[i]) tacno=false;
 }

 if(tacno){
  krune+=2;
  streak++;
  if(streak>=3) difficulty++;
  document.getElementById("poruka").innerHTML="–ë—Ä–∞–≤–æ üëë";
  question++;
  setTimeout(nextQuestion,1000);
 }else{
  mistakes++;
  streak=0;
  if(difficulty>1) difficulty--;
  if(tacni[1]==="+") sabErrors++;
  if(tacni[1]==="-") oduzErrors++;
  document.getElementById("poruka").innerHTML="–ü–æ–∫—É—à–∞—ò –ø–æ–Ω–æ–≤–æ ‚ùå";
 }
 updateInfo();
}

function finish(){
 let rezultat={
  ime:ime,
  datum:today(),
  krune:krune,
  greske:mistakes,
  sabErrors:sabErrors,
  oduzErrors:oduzErrors
 };

 history.push(rezultat);
 localStorage.setItem("princessHistory",JSON.stringify(history));

 document.getElementById("rezultatCard").style.display="block";
 document.getElementById("rezultatCard").innerHTML=
 "<h3>üëë –†–µ–∑—É–ª—Ç–∞—Ç üëë</h3>"+
 "–ö—Ä—É–Ω–µ: "+krune+
 "<br>–ì—Ä–µ—à–∫–µ: "+mistakes;

 drawChart();
 generateReport();
}

function drawChart(){
 let ctx=document.getElementById("progressChart");
 let labels=history.map((h,i)=>"–ò–≥—Ä–∞ "+(i+1));
 let data=history.map(h=>h.krune);

 new Chart(ctx,{
  type:"line",
  data:{
   labels:labels,
   datasets:[{
    label:"–ö—Ä—É–Ω–µ",
    data:data,
    borderColor:"#d946ef",
    fill:false
   }]
  }
 });
}

function generateReport(){
 let ukupno=history.length;
 let prosek=Math.round(history.reduce((a,b)=>a+b.krune,0)/ukupno);
 let ukupnoGresaka=history.reduce((a,b)=>a+b.greske,0);

 let slabost="–°—Ç–∞–±–∏–ª–∞–Ω —Ä–∞–∑–≤–æ—ò.";
 if(ukupnoGresaka/ukupno>3) slabost="–ü–æ—Ç—Ä–µ–±–Ω–∞ –¥–æ–¥–∞—Ç–Ω–∞ –ø–æ–¥—Ä—à–∫–∞.";
 if(prosek>15) slabost="–ò–∑—É–∑–µ—Ç–∞–Ω –Ω–∞–ø—Ä–µ–¥–∞–∫!";

 document.getElementById("report").innerHTML=
 "–ë—Ä–æ—ò –æ–¥–∏–≥—Ä–∞–Ω–∏—Ö –∏–≥–∞—Ä–∞: "+ukupno+
 "<br>–ü—Ä–æ—Å–µ—á–Ω–µ –∫—Ä—É–Ω–µ: "+prosek+
 "<br>–£–∫—É–ø–Ω–µ –≥—Ä–µ—à–∫–µ: "+ukupnoGresaka+
 "<br><br>üìå –ü—Ä–æ—Ü–µ–Ω–∞: "+slabost;
}
</script>

</body>
</html>
